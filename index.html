<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Вычислить цену</title>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.min.js"></script> -->
  </head>
  <body>
    <h1>Upload an excel file to convert into JSON</h1>
    <form class="price-form">
      <input type="file" id="file_upload" />
      <!-- <button onclick="upload()">Upload</button> -->
      <button class="btn-submit">Рассчитать</button>
    </form>

    <input class="percentage" type="text" value="30" />
    <br />
    <br />
    <!-- container to display the json result -->
    <textarea
      id="json-result"
      style="display: none; height: 500px; width: 1000px"
    ></textarea>

    <script>
      // // Method to upload a valid excel file
      // function upload() {
      //   var files = document.getElementById("file_upload").files;
      //   if (files.length == 0) {
      //     alert("Please choose any file...");
      //     return;
      //   }
      //   var filename = files[0].name;
      //   var extension = filename
      //     .substring(filename.lastIndexOf("."))
      //     .toUpperCase();
      //   if (extension == ".XLS" || extension == ".XLSX") {
      //     excelFileToJSON(files[0]);
      //   } else {
      //     alert("Please select a valid excel file.");
      //   }
      // }

      // //Method to read excel file and convert it into JSON
      // function excelFileToJSON(file) {
      //   try {
      //     var reader = new FileReader();
      //     reader.readAsBinaryString(file);
      //     reader.onload = function (e) {
      //       var data = e.target.result;
      //       var workbook = XLSX.read(data, {
      //         type: "binary",
      //       });
      //       var result = {};
      //       workbook.SheetNames.forEach(function (sheetName) {
      //         var roa = XLSX.utils.sheet_to_row_object_array(
      //           workbook.Sheets[sheetName]
      //         );
      //         if (roa.length > 0) {
      //           result[sheetName] = roa;
      //         }
      //       });
      //       //displaying the json result
      //       // var resultEle=document.getElementById("json-result");
      //       // resultEle.value=JSON.stringify(result, null, 4);
      //       // const obj = result["TDSheet"];
      //       // const arrObj = result.map(item => item);
      //       const obj = result["TDSheet"];
      //       console.log(result);
      //       // const obj = result[0];

      //       const userPercentage = document.querySelector(".percentage");
      //       // const percentage = 10;
      //       const percentage = userPercentage.value;

      //       const getDiscountPrice = (sum, count) => {
      //         let result = 0;
      //         if (sum !== undefined) {
      //           const strWithoutSpace = sum.replace(/ /g, "");
      //           const strWithDot = strWithoutSpace.replace(",", ".");
      //           const finalNum = parseFloat(strWithDot);
      //           result += finalNum;
      //         }
      //         return result / parseFloat(count);
      //       };

      //       const filtedItem = obj.filter(item => !isNaN(item["__EMPTY_1"]));

      //       const finalResult = filtedItem.map(item => {
      //         const discountPrice = getDiscountPrice(
      //           item["__EMPTY_66"],
      //           item["__EMPTY_32"]
      //         );
      //         const sellPrice =
      //           discountPrice + (discountPrice / 100) * percentage;
      //         return {
      //           "№": item["__EMPTY_1"],
      //           Артикул: item["__EMPTY_3"],
      //           "Товары (работы, услуги)": item["__EMPTY_6"],
      //           Количество: item["__EMPTY_32"],
      //           Цена: item["__EMPTY_42"],
      //           "Сумма\nбез скидки": item["__EMPTY_50"],
      //           Скидка: item["__EMPTY_58"],
      //           Сумма: item["__EMPTY_66"],
      //           "Цена со скидкой, шт": discountPrice.toFixed(2),
      //           "Цена с наценкой, шт": sellPrice.toFixed(2),
      //         };
      //       });

      //       var resultEle = document.getElementById("json-result");
      //       resultEle.value = JSON.stringify(finalResult, null, 4);

      //       resultEle.style.display = "block";
      //     };
      //   } catch (e) {
      //     console.error(e);
      //   }
      // }

      // const formElement = document.querySelector(".price-form");
      // formElement.addEventListener("submit", e => {
      //   e.preventDefault();
      //   console.log("doj");
      //   upload();
      // });

      // // const hui = document.querySelector(".hui");
      // // hui.addEventListener("click", e => {
      // //   e.preventDefault();
      // //   console.log("doj");
      // // });
    </script>
  </body>
</html>
